{% load markdownify %}
{% load title %}
<article>
  <!-- Post body -->
  {{post | markdownify:truncate | safe}}
  
  <div class="clearfix"></div>
  <!-- Chapters -->
  {% if post.parent and not truncate %}
  <!-- 
  <span class="btn btn-default left">
    < Prev
  </span>
  <span class="btn btn-default right">
    Next > 
  </span>
  -->
  <div class="dropdown toc">
    <span class="btn btn-default">
      {{post|title|striptags}}
    </span>
    <ul class="dropdown-menu dropdown-menu-right" role="menu">    
      {% for child in post.parent.children.all %}	  	      
      <li>
	<a href="{{child.get_absolute_url}}"
	   {% if child == post %}
	   class="active"
	   {% endif %}>
	  {{ forloop.counter }}.
	  {{child|title|striptags}}		    
	</a>
      </li>
      {% endfor %}	  	      
    </ul>
  </div>
  {% endif %}  
  <div class="clearfix"></div>

  <!-- Footer -->
  <div class="post-footer">
    <!-- Categories/tags -->
    {% if post.category %}
    <span class="label label-default">
      {% if profile %}
      <a href="/@{{profile.username}}/{{post.category.slug}}">
	{{post.category.title}}</a>
      {% else %}
      <a href="/{{post.category.slug}}">
	{{post.category.title}}</a>      
      {% endif %}
    </span>
    {% endif %}	<!-- endif post.category -->
    
    {% for tag in post.tags.all %}
    <span class="label label-default">
      {% if profile %}
      <a href="/@{{profile.username}}/tag/{{post.category.slug}}">
	{{tag.title}}</a>
      {% else %}
      <a href="/tag/{{tag.slug}}" >
	{{tag.title}}</a>
      {% endif %}      
    </span>
    {% endfor %}


    <!-- Actions -->
    <div class="right">
      <!-- Profile -->
      <a class="btn btn-default"
	 href="/@{{post.author.username}}"
	 data-toggle="tooltip" data-placement="top"
	 title="Profile">
	@{{post.author.username}}
      </a>
      {% if post.author in  user.subscribed_to.all %}
      <a class="btn btn-default"
	 href="/@{{post.author.username}}/unsubscribe"
	 data-toggle="tooltip" data-placement="top"
	 title="Un-Subscribe">
	<i class="fa fa-user-times gray"></i> 
	{{post.author.subscribers.count}}
      </a>
      {% else %}          
      <a class="btn btn-default"
	 href="/@{{post.author.username}}/subscribe"
	 data-toggle="tooltip" data-placement="top"
	 title="Subscribe">
	<i class="fa fa-user-plus"></i> 
	{{post.author.subscribers.count}}
      </a>
      {% endif %}          
      <!-- Voting -->
      {% if user.is_authenticated %}    
      <a class="btn btn-default upvote
		{% if user ==  post.author %}disabled{% endif %}
		{% if post in user.upvoted.all %}upvoted{% endif %}"
	 id="post-upvote-{{post.id}}"
	 data-toggle="tooltip" data-placement="top"
	 title="Upvote">
	<i class="fi-arrow-up"></i>
	{{post.score}}
      </a>
      {% else %}
      <!-- If not authenticated - open login popup. -->
      <a class="btn btn-default"
	 data-toggle="modal" data-target="#login"
	 title="Login to Upvote">
	<i class="fa fa-arrow-up"></i>
	{{post.score}}
      </a>    
      {% endif %}    
      <!-- Comments -->
      <a class="btn btn-default"
	 href="{{post.get_absolute_url}}"
	 data-toggle="tooltip" data-placement="top"
	 title="Comment">      
	<i class="fi-comment"></i>
	{{post.comments.count}}
      </a>
      <!-- Edit -->
      {% if request.user == post.author %}
      <a class="btn btn-default" href="{{post.get_absolute_url}}edit">
	<i class="fa fa-pencil"></i>
	<!-- Unpublished -->
	{% if not post.published %}Draft{% endif %}            
      </a>
      {% endif %}    
    </div>
    <div class="clearfix"></div>
  </div>
</article>
